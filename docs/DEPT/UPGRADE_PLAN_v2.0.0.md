# Upgrade Plan: Repo-Spec-Zero v2.0.0

## Submodule-Based Spec Management with Generation/Audit Modes

**Status:** IMPLEMENTED  
**Target Version:** 2.0.0  
**Created:** 2026-01-16  
**Updated:** 2026-01-16  
**Breaking Changes:** Yes (removes legacy arch-docs mode)

---

## Executive Summary

This upgrade transforms the plugin from a simple spec generator to an intelligent **Generation + Audit system** with Git submodule integration. Key changes:

- **Two separate operations**: `analyze` (always produces report) and `apply` (explicit request)
- **Generation mode**: First-time analysis creates full specs
- **Audit mode**: Subsequent runs produce AUDIT_REPORT.md without modifying existing specs
- **Submodule isolation**: Specs live in dedicated Git repos, linked as submodules
- **SPEC-OS integration**: Plugin is the bootstrap layer for the broader SPEC-OS ecosystem

---

## Context: Spec-Zero in SPEC-OS Ecosystem

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        SPEC-ZERO (This Plugin)                              │
│                                                                             │
│  Role: Bootstrap generator - creates initial specs from codebase analysis  │
│                                                                             │
│  Input:  Source repository                                                  │
│  Output: Specs in dedicated submodule (my-project-specs/)                  │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                          SPEC-OS VAULT                                      │
│                                                                             │
│  - Imports specs generated by Spec-Zero (via submodule link)               │
│  - Manual domain specs created/evolved here                                │
│  - Development strategies defined                                          │
│  - Task generation (out of scope for this plugin)                          │
│                                                                             │
│  The submodule is linked INTO the vault for unified navigation             │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                      PROPAGATION (Future Scope)                             │
│                                                                             │
│  - Transition specs → Target implementation areas                          │
│  - Task generation → Issue trackers                                        │
│  - Domain specs → Implementation guides                                    │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## Two Separate Operations

### Operation 1: ANALYZE (Always Report Only)

```bash
spec-zero analyze /path/to/repo
```

**Behavior:**

| Condition | Mode | Action |
|-----------|------|--------|
| No specs exist | GENERATION | Creates full specs in `_generated/`, commits & pushes |
| Specs exist | AUDIT | Produces `AUDIT_REPORT.md` only, does NOT modify existing specs |

### Operation 2: APPLY (Explicit Request)

```bash
spec-zero apply /path/to/repo [--all | --file=api.md | --interactive]
```

**Behavior:**
- Reads latest `AUDIT_REPORT.md`
- Applies changes to specs in `_generated/`
- Updates manifest with new version
- Commits & pushes
- Archives audit report to `_audits/`

---

## Architecture Overview

### Current State (v1.1.0)

```
analyzed-repo/
├── .git/
├── arch-docs/           # Specs written directly (pollutes repo)
│   ├── index.md
│   └── ...
└── src/
```

### Target State (v2.0.0)

```
analyzed-repo/
├── .git/
├── .gitmodules                # Submodule reference
├── specs/                     # Submodule → my-project-specs repo
│   ├── .meta/
│   │   ├── manifest.json      # Version tracking
│   │   └── config.json        # Plugin configuration
│   │
│   ├── _generated/            # AUTO-GENERATED (Spec-Zero manages)
│   │   ├── overview.md
│   │   ├── module.md
│   │   ├── api.md
│   │   ├── entity.md
│   │   └── ...
│   │
│   ├── _audits/               # Archived audit reports
│   │   ├── 2026-01-16_v1.0.0_audit.md
│   │   └── 2026-01-17_v1.1.0_audit.md
│   │
│   ├── domains/               # MANUAL (Spec-Zero ignores completely)
│   │   ├── auth-domain.md
│   │   ├── payment-domain.md
│   │   └── ...
│   │
│   ├── AUDIT_REPORT.md        # Current pending audit (if any)
│   │
│   └── index.md               # Mixed: <!-- AUTO --> + <!-- MANUAL -->
│
└── src/
```

---

## Key Design Decisions

| Decision | Choice | Rationale |
|----------|--------|-----------|
| Specs location | Dedicated remote repo per project | Clean separation, independent versioning |
| First-time setup | Automatic with confirmation | UX: minimal friction |
| Versioning | SemVer automatic | Industry standard, meaningful versions |
| Legacy mode | Removed | Simplify codebase, force best practice |
| Analyze behavior | Always report only | Non-destructive, user controls changes |
| Apply behavior | Explicit separate command | Clear separation of concerns |
| Manual content | `domains/` folder ignored | Spec-Zero never touches manual work |
| Audit history | `_audits/` folder | Full history preserved |

---

## Mode Detection Logic

```typescript
function detectMode(specsPath: string): 'generation' | 'audit' {
  const manifestPath = path.join(specsPath, '.meta', 'manifest.json');
  
  if (!fs.existsSync(manifestPath)) {
    return 'generation'; // First time
  }
  
  const manifest = readManifest(manifestPath);
  if (manifest.analyses.length === 0) {
    return 'generation'; // Manifest exists but empty
  }
  
  return 'audit'; // Specs exist, enter audit mode
}
```

---

## Workflow: Generation Mode (First Run)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  1. INIT PHASE                                                              │
│     SubmoduleCheckAgent                                                     │
│     - Detect no specs submodule exists                                      │
│     - Prompt user for confirmation                                          │
│     - Create remote repo (my-project-specs)                                │
│     - Add as submodule at specs/                                           │
│     - Initialize folder structure                                          │
└─────────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│  2. ANALYSIS PHASE                                                          │
│     Full DAG Execution (19 agents)                                          │
│     - Bootstrap reads key files                                             │
│     - All analysis agents run                                               │
│     - Summary generates index.md                                            │
└─────────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│  3. WRITE PHASE                                                             │
│     WriteSpecsAgent                                                         │
│     - Write all outputs to _generated/                                     │
│     - Create manifest.json with v1.0.0                                     │
│     - Generate index.md with AUTO/MANUAL sections                          │
└─────────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│  4. COMMIT & PUSH PHASE                                                     │
│     CommitPushAgent                                                         │
│     - Commit in submodule: "specs: v1.0.0 - Initial generation"            │
│     - Push submodule                                                        │
│     - Commit in parent: "chore: add specs submodule"                       │
│     - Push parent                                                           │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## Workflow: Audit Mode (Subsequent Runs)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  1. INIT PHASE                                                              │
│     SubmoduleCheckAgent                                                     │
│     - Detect specs submodule exists                                         │
│     - Run git submodule update --init                                      │
│     - Read manifest.json → mode = 'audit'                                  │
│     - Read existing specs for context                                       │
└─────────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│  2. ANALYSIS PHASE                                                          │
│     Full DAG Execution (19 agents)                                          │
│     - Same as generation mode                                               │
│     - Produces "fresh" analysis in memory                                  │
└─────────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│  3. AUDIT PHASE (replaces Write Phase)                                      │
│     AuditReportAgent                                                        │
│     - Compare fresh analysis with existing _generated/ files              │
│     - Generate AUDIT_REPORT.md with all discrepancies                      │
│     - DO NOT modify any existing spec files                                │
└─────────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│  4. COMMIT & PUSH PHASE                                                     │
│     CommitPushAgent                                                         │
│     - Commit ONLY AUDIT_REPORT.md                                          │
│     - Message: "audit: detected N changes vs v1.2.0"                       │
│     - Push submodule                                                        │
│     - Update parent submodule ref if needed                                │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## Workflow: Apply Command

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  1. VALIDATE PHASE                                                          │
│     - Check AUDIT_REPORT.md exists                                         │
│     - Parse changes from report                                             │
│     - Validate all referenced files exist                                  │
└─────────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│  2. APPLY PHASE                                                             │
│     ApplyChangesAgent                                                       │
│     - For each change in report:                                           │
│       - ADDED: Create new file in _generated/                             │
│       - MODIFIED: Update existing file                                     │
│       - REMOVED: Mark as deprecated (don't delete)                        │
│     - Calculate new SemVer version                                         │
│     - Update manifest.json                                                  │
└─────────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│  3. ARCHIVE PHASE                                                           │
│     - Move AUDIT_REPORT.md to _audits/YYYY-MM-DD_vX.X.X_audit.md          │
└─────────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│  4. COMMIT & PUSH PHASE                                                     │
│     - Commit all changes: "specs: v1.3.0 - Applied audit changes"         │
│     - Push submodule                                                        │
│     - Update parent submodule ref                                          │
│     - Push parent                                                           │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## AUDIT_REPORT.md Structure

```markdown
---
uid: "my-project:spec:audit"
title: "Spec Audit Report"
status: pending
generated: 2026-01-17T14:00:00Z
repo_sha: abc123def456789
repo_branch: main
plugin_version: 2.0.0
current_specs_version: 1.2.0
proposed_version: 1.3.0
---

## Executive Summary

This audit detected **23 changes** comparing the current codebase 
(commit `abc123d`) against specs v1.2.0.

| Category | Count |
|----------|-------|
| New items detected | 12 |
| Removed items | 3 |
| Modified items | 8 |
| Files affected | 5 |

## Action Required

To apply these changes, run:

```bash
spec-zero apply /path/to/repo
```

---

## Changes by File

### _generated/api.md

#### ADDED

| Item | Location | Description |
|------|----------|-------------|
| `POST /api/users` | `src/api/users.ts:45` | New user creation endpoint |
| `GET /api/users/:id/profile` | `src/api/users.ts:78` | User profile endpoint |

<details>
<summary>Detected code</summary>

```typescript
// src/api/users.ts:45
router.post('/users', validateBody(createUserSchema), async (req, res) => {
  const user = await userService.create(req.body);
  res.status(201).json(user);
});
```

</details>

#### REMOVED

| Item | Previous Location | Notes |
|------|-------------------|-------|
| `DELETE /api/legacy` | Was at `src/api/legacy.ts` | File deleted from codebase |

#### MODIFIED

| Item | Location | Change Description |
|------|----------|-------------------|
| `GET /api/orders/:id` | `src/api/orders.ts:120` | Response now includes `tracking` field |

<details>
<summary>Diff</summary>

```diff
Response schema:
- { id, items, total, status }
+ { id, items, total, status, tracking, estimatedDelivery }
```

</details>

---

### _generated/module.md

#### ADDED

| Module | Location | Description |
|--------|----------|-------------|
| `NotificationService` | `src/services/notification/` | New notification handling module |

---

### _generated/entity.md

#### MODIFIED

| Entity | Change | Details |
|--------|--------|---------|
| `User` | Fields added | `lastLoginAt: DateTime`, `preferences: JSON` |

---

## Appendix: Version Calculation

Based on changes detected:
- 12 new items → minor version bump
- 3 removed items → minor version bump  
- 8 modifications → patch if only, minor if structural

**Proposed version: 1.2.0 → 1.3.0** (minor bump due to new endpoints/modules)
```

---

## Manifest Structure

```json
{
  "schema_version": "2.0",
  "project": {
    "name": "my-project",
    "repo_url": "https://github.com/org/my-project",
    "specs_repo_url": "https://github.com/org/my-project-specs",
    "created": "2026-01-16T14:00:00Z"
  },
  "current_version": "1.2.0",
  "mode": "audit",
  "pending_audit": true,
  "analyses": [
    {
      "version": "1.0.0",
      "type": "generation",
      "date": "2026-01-16T14:00:00Z",
      "repo_sha": "abc123def456...",
      "repo_branch": "main",
      "specs_sha": "789ghi012jkl...",
      "plugin_version": "2.0.0",
      "agents_run": 19,
      "agents_succeeded": 17,
      "files_generated": ["overview.md", "module.md", "api.md", "..."]
    },
    {
      "version": "1.1.0",
      "type": "apply",
      "date": "2026-01-17T10:00:00Z",
      "repo_sha": "xyz789abc012...",
      "repo_branch": "main",
      "specs_sha": "mno345pqr678...",
      "plugin_version": "2.0.0",
      "from_audit": "2026-01-17_v1.0.0_audit.md",
      "files_changed": ["module.md", "api.md"],
      "summary": "Applied audit: +2 endpoints, +1 module"
    }
  ],
  "audits": [
    {
      "date": "2026-01-17T09:00:00Z",
      "repo_sha": "xyz789abc012...",
      "specs_version_compared": "1.0.0",
      "changes_detected": 15,
      "status": "applied",
      "applied_as_version": "1.1.0",
      "archived_to": "_audits/2026-01-17_v1.0.0_audit.md"
    },
    {
      "date": "2026-01-18T09:00:00Z",
      "repo_sha": "def456ghi789...",
      "specs_version_compared": "1.1.0",
      "changes_detected": 8,
      "status": "pending"
    }
  ]
}
```

---

## index.md with AUTO/MANUAL Sections

```markdown
---
uid: "my-project:spec:index"
title: "My Project Specifications"
version: 1.2.0
generated: 2026-01-17
---

<!-- AUTO:START - Do not edit this section manually -->

## Project Overview

- **Name:** My Project
- **Type:** Backend Service
- **Tech Stack:** Node.js, TypeScript, PostgreSQL

## Generated Specifications

| Spec | Description | Last Updated |
|------|-------------|--------------|
| [Overview](_generated/overview.md) | High-level architecture | 2026-01-17 |
| [Modules](_generated/module.md) | Module breakdown | 2026-01-17 |
| [APIs](_generated/api.md) | API endpoints | 2026-01-17 |
| [Entities](_generated/entity.md) | Domain entities | 2026-01-16 |
| ... | ... | ... |

<!-- AUTO:END -->

<!-- MANUAL:START - Your custom content below -->

## Domain Specifications

| Domain | Owner | Status |
|--------|-------|--------|
| [Authentication](domains/auth-domain.md) | @security-team | Active |
| [Payments](domains/payment-domain.md) | @payments-team | Draft |

## Project Notes

Custom notes and documentation that Spec-Zero will never modify.

<!-- MANUAL:END -->
```

---

## Updated DAG Structure

### Generation Mode DAG

```
Layer 0:  submodule_check     ─────────────────────────────────────┐
          (creates submodule if needed)                            │
                                                                   ▼
Layer 1:  bootstrap           ◄──────────────────────── No existing specs
                                                        
Layer 2:  overview
Layer 3:  module, entity
Layer 4:  db, data_map, event, dependency, flag
Layer 5:  api, deployment
Layer 6:  service_dep, auth, security, prompt_sec, monitor, ml
Layer 7:  authz
Layer 8:  summary
                                                                   │
Layer 9:  write_specs         ◄────────────────────────────────────┘
          (writes to _generated/)
                                                                   │
Layer 10: commit_push         ◄────────────────────────────────────┘
          (commits & pushes both repos)
```

### Audit Mode DAG

```
Layer 0:  submodule_check     ─────────────────────────────────────┐
          (loads existing specs)                                   │
                                                                   ▼
Layer 1:  bootstrap           ◄──────────────────────── Reads existing specs
                                                        for context
Layer 2:  overview
Layer 3:  module, entity
Layer 4:  db, data_map, event, dependency, flag
Layer 5:  api, deployment
Layer 6:  service_dep, auth, security, prompt_sec, monitor, ml
Layer 7:  authz
Layer 8:  summary
                                                                   │
Layer 9:  audit_report        ◄────────────────────────────────────┘
          (compares & generates AUDIT_REPORT.md ONLY)
                                                                   │
Layer 10: commit_push         ◄────────────────────────────────────┘
          (commits ONLY audit report)
```

### Apply Command Flow (Separate from DAG)

```
ApplyCommand
    │
    ├── 1. Read AUDIT_REPORT.md
    ├── 2. Parse changes
    ├── 3. Apply to _generated/ files
    ├── 4. Update manifest
    ├── 5. Archive audit report
    ├── 6. Commit & push submodule
    └── 7. Update parent ref & push
```

---

## Implementation Phases

### Phase 1: Types & Interfaces

**File:** `src/types.ts`

```typescript
// Submodule management
export interface SubmoduleConfig {
  path: string;           // "specs"
  remoteUrl: string;      // "git@github.com:org/my-project-specs.git"
  branch: string;         // "main"
}

export interface SubmoduleState {
  exists: boolean;
  initialized: boolean;
  config?: SubmoduleConfig;
  manifest?: SpecsManifest;
  specsPath: string;
  mode: 'generation' | 'audit';
}

// Manifest
export interface SpecsManifest {
  schema_version: "2.0";
  project: ProjectInfo;
  current_version: string;
  mode: 'generation' | 'audit';
  pending_audit: boolean;
  analyses: AnalysisEntry[];
  audits: AuditEntry[];
}

export interface ProjectInfo {
  name: string;
  repo_url: string;
  specs_repo_url: string;
  created: string;
}

export interface AnalysisEntry {
  version: string;
  type: 'generation' | 'apply';
  date: string;
  repo_sha: string;
  repo_branch: string;
  specs_sha: string;
  plugin_version: string;
  agents_run: number;
  agents_succeeded: number;
  files_generated?: string[];
  files_changed?: string[];
  from_audit?: string;
  summary?: string;
}

export interface AuditEntry {
  date: string;
  repo_sha: string;
  specs_version_compared: string;
  changes_detected: number;
  status: 'pending' | 'applied' | 'dismissed';
  applied_as_version?: string;
  archived_to?: string;
}

// Audit report
export interface AuditReport {
  meta: AuditReportMeta;
  summary: AuditSummary;
  changes: FileChanges[];
}

export interface AuditReportMeta {
  generated: string;
  repo_sha: string;
  repo_branch: string;
  plugin_version: string;
  current_specs_version: string;
  proposed_version: string;
}

export interface AuditSummary {
  total_changes: number;
  added: number;
  removed: number;
  modified: number;
  files_affected: number;
}

export interface FileChanges {
  file: string;
  added: ChangeItem[];
  removed: ChangeItem[];
  modified: ChangeItem[];
}

export interface ChangeItem {
  item: string;
  location?: string;
  description: string;
  code_snippet?: string;
  diff?: string;
}
```

**Estimated time:** 20 minutes

---

### Phase 2: SubmoduleManager Skill

**File:** `src/skills/submodule-manager.skill.ts`

Same as before, plus:

```typescript
// Additional methods for audit support
async readExistingSpecs(specsPath: string): Promise<Map<string, string>>;
async archiveAuditReport(specsPath: string, version: string): Promise<string>;
async hasPendingAudit(specsPath: string): Promise<boolean>;
```

**Estimated time:** 50 minutes

---

### Phase 3: SubmoduleCheckAgent

**File:** `src/agents/core/submodule-check.agent.ts`

Now also:
- Detects mode (generation vs audit)
- Loads existing specs content for audit comparison
- Sets `context.mode` for downstream agents

**Estimated time:** 45 minutes

---

### Phase 4: WriteSpecsAgent (Generation Mode)

**File:** `src/agents/spec-zero/finalizer/write-specs.agent.ts`

- Only runs in generation mode
- Writes all outputs to `_generated/`
- Creates initial manifest
- Generates index.md with AUTO/MANUAL sections

**Estimated time:** 30 minutes

---

### Phase 5: AuditReportAgent (Audit Mode)

**File:** `src/agents/spec-zero/finalizer/audit-report.agent.ts`

- Only runs in audit mode
- Compares fresh analysis with existing specs
- Generates comprehensive AUDIT_REPORT.md
- Does NOT modify any existing files
- Updates manifest with audit entry (status: pending)

**Estimated time:** 60 minutes

---

### Phase 6: ApplyChangesAgent

**File:** `src/agents/spec-zero/finalizer/apply-changes.agent.ts`

- Invoked by `apply` command, not part of analyze DAG
- Reads AUDIT_REPORT.md
- Applies changes to _generated/ files
- Calculates new version
- Archives audit report
- Updates manifest

**Estimated time:** 45 minutes

---

### Phase 7: CommitPushAgent Update

**File:** `src/agents/spec-zero/finalizer/commit-push.agent.ts`

Now handles three scenarios:
1. Generation: commit all specs
2. Audit: commit only AUDIT_REPORT.md
3. Apply: commit updated specs + archived audit

**Estimated time:** 30 minutes

---

### Phase 8: DAG Executor Update

**File:** `src/core/dag-executor.ts`

- Two DAG definitions: `GENERATION_DAG` and `AUDIT_DAG`
- Mode-based DAG selection

**Estimated time:** 20 minutes

---

### Phase 9: Orchestrator Update

**File:** `src/agents/core/orchestrator.agent.ts`

- Detect mode from submodule state
- Select appropriate DAG
- Support `apply` command routing

**Estimated time:** 30 minutes

---

### Phase 10: CLI Commands

**File:** `src/commands/` (new)

```typescript
// analyze command
export async function analyzeCommand(repoPath: string): Promise<void>;

// apply command  
export async function applyCommand(
  repoPath: string, 
  options: { all?: boolean; file?: string; interactive?: boolean }
): Promise<void>;
```

**Estimated time:** 30 minutes

---

### Phase 11: Remove Legacy & Test

- Remove arch-docs logic
- Update all tests
- Integration testing
- Bump to 2.0.0
- Publish

**Estimated time:** 45 minutes

---

## File Changes Summary

| Action | File |
|--------|------|
| CREATE | `src/types.ts` (major additions) |
| CREATE | `src/skills/submodule-manager.skill.ts` |
| CREATE | `src/agents/core/submodule-check.agent.ts` |
| CREATE | `src/agents/spec-zero/finalizer/write-specs.agent.ts` |
| CREATE | `src/agents/spec-zero/finalizer/audit-report.agent.ts` |
| CREATE | `src/agents/spec-zero/finalizer/apply-changes.agent.ts` |
| CREATE | `src/commands/analyze.ts` |
| CREATE | `src/commands/apply.ts` |
| UPDATE | `src/agents/spec-zero/finalizer/commit-push.agent.ts` |
| UPDATE | `src/core/dag-executor.ts` |
| UPDATE | `src/core/context.ts` |
| UPDATE | `src/agents/core/orchestrator.agent.ts` |
| UPDATE | `src/agents/core/bootstrap.agent.ts` |
| UPDATE | `src/index.ts` |
| UPDATE | `package.json` |
| UPDATE | `README.md` |
| DELETE | `src/skills/output-writer.skill.ts` (legacy) |
| DELETE | arch-docs related code |

---

## Timeline

| Phase | Description | Complexity | Time |
|-------|-------------|------------|------|
| 1 | Types & Interfaces | Low | 20 min |
| 2 | SubmoduleManager | High | 50 min |
| 3 | SubmoduleCheckAgent | High | 45 min |
| 4 | WriteSpecsAgent | Medium | 30 min |
| 5 | AuditReportAgent | High | 60 min |
| 6 | ApplyChangesAgent | High | 45 min |
| 7 | CommitPushAgent Update | Medium | 30 min |
| 8 | DAG Executor Update | Low | 20 min |
| 9 | Orchestrator Update | Medium | 30 min |
| 10 | CLI Commands | Medium | 30 min |
| 11 | Remove Legacy & Test | Medium | 45 min |
| **Total** | | | **~6.5 hours** |

---

## Migration Guide

### For Users

1. Update plugin: `npm install @mo-hhy/opencode-plugin-repo-spec-zero@2.0.0`
2. First run creates specs submodule automatically
3. Subsequent runs produce audit reports (non-destructive)
4. Use `spec-zero apply` to apply detected changes
5. Existing `arch-docs/` must be manually migrated

### Breaking Changes

- `arch-docs/` output mode completely removed
- Requires Git repository
- Requires `gh` CLI for automatic repo creation
- Two-step workflow: analyze then apply

---

## Open Questions

1. **GitHub CLI dependency**: Require `gh` or fallback to manual URL?
2. **Private repos**: Authentication for private specs repos?
3. **CI/CD**: Detect CI and skip interactive prompts?
4. **Partial apply**: Allow applying specific changes only?
5. **Conflict resolution**: What if manual edits conflict with apply?

---

## Appendix: Git Commands Reference

```bash
# Check if submodule exists
git config --file .gitmodules --get-regexp path

# Add submodule
git submodule add -b main git@github.com:org/specs.git specs

# Initialize submodule
git submodule update --init --recursive

# Get submodule SHA
git ls-tree HEAD specs | awk '{print $3}'

# Commit in submodule
cd specs && git add . && git commit -m "message" && git push

# Update submodule reference in parent
git add specs && git commit -m "update submodule"

# Create GitHub repo (requires gh CLI)
gh repo create org/my-project-specs --private --description "Specs for my-project"

# Check for pending changes in submodule
cd specs && git status --porcelain
```
